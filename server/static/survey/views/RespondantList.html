<div class="container" ng-cloak>
    <div class="row">
        <div ng-include="'/static/survey/views/sideNav.html'"></div>
        <div class="col-md-9">
            <div class="row">
                <!-- <h1>Completed {{ survey.name }}s -- <small>{{ survey.survey_responses |number}} reports submitted</small></h1> -->
                <h1>Catch Report Review: {{ area || 'All Islands' }} <i ng-show="busy" class="icon-spinner icon-spin"></i>
                </h1>
                <div>
                    <div class="row filter-box">
                        <div class="col-md-7">
                            <div ng-include="'/static/survey/views/areaButtons.html'"></div>
                        </div>

                        <div class="col-md-5">
                            <div class="form-control date-range-picker" date-range-picker min="filter.min" max="filter.max" start="filter.startDate" end="filter.endDate"></div>
                        </div>
                    </div>
                    <div class="row filter-box">
                        <div class="col-md-6">
                            
                        </div>
                        <div class="col-md-5 col-md-offset-1">
                            <select class="form-control" ng-model="filter.review_status">
                                <option value="">All Review States</option>
                                <option value="accepted">Accepted</option>
                                <option value="flagged">Flagged</option>
                                <option value="needs review">Needs Review</option>
                            </select>
                        </div>
                    </div>
                    <div class="row" ng-hide="respondents.length || busy">
                        <div class='col-md-12'>
                            <div class="alert alert-warning">
                                No records for these filters. <a ng-click="clearFilters()" class="alert-link">Clear Filters?</a>
                            </div>
                        </div>
                    </div>
                    <div class="row" ng-show="respondents.length">
                        <div class="col-md-12">
                            <div class="panel panel-default" ng-repeat="respondent in respondents">
                                <!-- track by $index is present to prevent 'Duplicates in repeater' error -->
                                <div class="panel-heading respondent-header" ng-click="openRespondent(respondent)" ng-class="{ 'darkSalmonBackground': respondent.open }">
                                    <h4 class="panel-title">
                                        {{ respondent.user.username }} --
                                        <span ng-show="respondent.complete">{{ respondent.ordering_date | date: 'MM/dd/yyyy' }}</span>
                                        <i ng-show="respondent.spin" class="icon-spinner icon-spin"></i>
                                        <div class="pull-right">
                                            <span class="label" ng-class="{ 'label-default': respondent.review_status == 'needs review', 'label-success': respondent.review_status == 'accepted', 'label-danger': respondent.review_status == 'flagged' }">
                                                {{ respondent.review_status }}
                                            </span>

                                        </div>
                                    </h4>
                                </div>
                                <div id="{{ respondent.survey_title }}" class="panel-collapse collapse" ng-class="{ 'in': respondent.open }">
                                    <div class="panel-body">
                                        <div class="row report-controls">
                                            <div class="col-md-6" ng-if="respondent.open">
                                                <div dash-map island="$parent.activeRespondent.island" locations="$parent.activeRespondent.areas_fished"></div>
                                            </div>
                                            <div class="col-md-6">
                                                <form role="form">
                                                    <div class="form-group">
                                                        <textarea ng-model="respondent.comment" placeholder="comments" class="form-control" rows="10"></textarea>
                                                    </div>
                                                    <div class="form-group">
                                                        <div class="checkbox">
                                                            <label>
                                                                <input type="checkbox" ng-model="respondent.notify">Share comment with fisher
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="pull-right">
                                                        <a class="btn btn-default" target="_blank" href="#/RespondantDetail/{{survey.slug}}/{{respondent.uuid}}">
                                                            <span class="glyphicon glyphicon-pencil">Edit</span>
                                                        </a>
                                                        <a class="btn" ng-click="setStatus(respondent, 'accepted')" ng-class="{ 'btn-success': respondent.review_status == 'accepted', 'btn-default': respondent.review_status != 'accepted' }">
                                                            <span class="glyphicon" ng-class="{ 'glyphicon-check': respondent.review_status == 'accepted', 'glyphicon-unchecked': respondent.review_status != 'accepted'  }">Approve
                                                        </a>
                                                        <a class="btn" ng-click="setStatus(respondent, 'flagged')" ng-class="{ 'btn-danger': respondent.review_status == 'flagged', 'btn-default': respondent.review_status != 'flagged' }">
                                                            <span class="glyphicon" ng-class="{ 'glyphicon-check': respondent.review_status == 'flagged', 'glyphicon-unchecked': respondent.review_status != 'flagged'  }">Flag
                                                        </a>
                                                        <button class="btn btn-default" ng-click="saveComment(respondent, respondent.comment, respondent.notify)">Save Comment</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <div ng-include="viewPath + 'views/surveyAnswers.html'"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-9">
                                    <p>
                                        Showing {{ respondents.length }} of {{ meta.total_count }}
                                        <span ng-hide="survey.survey_responses == meta.total_count">filtered from {{survey.survey_responses || 0}}</span>
                                    </p>
                                </div>
                                <div class="col-md-3">
                                    <ul class="pager">
                                        <li class="previous" ng-class="{ 'disabled': !meta.next }">
                                            <a ng-disabled="! meta.next" ng-click="getReports(meta.next, true)">&larr; Previous</a>
                                        </li>
                                        <li class="next" ng-class="{ 'disabled': !meta.previous }">
                                            <a ng-disabled="! meta.previous" ng-click="getReports(meta.previous, true)">Next &rarr;</a>
                                        </li>
                                    </ul>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div ng-show="busy" ng-include="viewPath + 'static/survey/views/spinner.html'"></div>
        </div>
    </div>
</div>
